#! /usr/bin/env node

const commander = require('commander');
const ora = require('ora');
const chalk = require('../lib/chalk');
const download = require('../lib/download');
const spinner = ora();
const { checkHttps } = require('../utils/tool');
commander
  .version(require('../package.json').version, '-v, --version')
  .description(
    `
    下载iconfont专用工具
    ---------
    icon-cli source 在当前运行目录下替换iconfont文件
    使用文档：https://songzhaopian.com
    `
  )
  .helpOption('-h, --help')
  .action(({}, source) => {
    if (source.length > 1) {
      spinner.warn(chalk.red('非法入参, 只接受一个资源地址'))
      spinner.stop();
      return ;
    }
    const url = checkHttps(source[0]);
    if (httpsVerify(url)) return;
    spinner.start(chalk.green('下载中... 请稍后'));
    download(url).then((msg) => {
      spinner.succeed(chalk.green(msg));
      spinner.stop();
    }).catch((msg) => {
      spinner.fail(chalk.redBright(msg));
      spinner.stop();
    })
  })
  .command('target')
  .description('icon-cli target 文件目录位置,相对路径 网络资源地址')
  .action(({}, source) => {
    if (source.length !== 2) {
      spinner.warn(chalk.red('非法入参, 你需要传入两个参数'))
      spinner.stop();
      return;
    }
    const path = source[0];
    const url = checkHttps(source[1]);
    console.info(httpsVerify(url));
    if (httpsVerify(url)) return;
    console.log('target------', source);
  });

commander
  .command('init')
  .description('icon-cli init 初始化下载配置,请在项目更目录下初始化')
  .action((args) => {
    console.log('init 操作', args)
  })

commander
  .command('d')
  .description('icon-cli d 依据下载配置,下载相关字体资源')
  .action(() => {
    console.log('d 下载操作')
  })

commander.parse(process.argv);

function httpsVerify(url) {
  if (!url) {
    spinner.warn(chalk.red('非法入参, 请确保是正确的 https://xxxxx 资源地址'))
    spinner.stop();
    return true;
  }
  return false;
}
